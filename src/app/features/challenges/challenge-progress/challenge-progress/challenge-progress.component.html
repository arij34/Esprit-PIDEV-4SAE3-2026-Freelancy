<div class="min-h-screen bg-[#EBF4FF]">
  <!-- Header Section -->
  <div class="bg-white border-b border-gray-200">
    <div class="w-full px-8 py-6">
      <div class="flex items-start justify-between">
        <div class="flex items-start gap-3">
          <button (click)="handleGoBack()" class="mt-1 p-1 rounded-md hover:bg-gray-100 transition-colors">
            <svg class="w-5 h-5 text-[#6B7280]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
            </svg>
          </button>
          <div>
            <h1 class="text-2xl font-semibold text-[#1F2937] mb-1">
              Challenge Progress
            </h1>
            <p class="text-sm text-[#6B7280]">
              Track your progress, manage tasks, and stay ahead of the deadline.
            </p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button (click)="handleViewRepository()" [disabled]="!participantRepoUrl" [class.opacity-50]="!participantRepoUrl" [class.cursor-not-allowed]="!participantRepoUrl" class="flex items-center gap-2 px-4 py-2 border border-[#1E3A8A] text-[#1E3A8A] hover:bg-[#1E3A8A]/10 rounded-lg transition-colors text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            View Repository
          </button>
          <button (click)="handleSubmitChallenge()" class="flex items-center gap-2 px-4 py-2 bg-[#1E3A8A] hover:bg-[#1E3A8A]/90 text-white rounded-lg transition-colors text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
            Submit Challenge
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex items-center justify-center py-20">
    <p class="text-[#6B7280] text-lg">Loading challenge data...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="max-w-[1200px] mx-auto px-6 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-8">
      <!-- Left Column - Tasks and Notes -->
      <div class="space-y-6">
        <!-- Motivation Banner -->
        <app-motivation-banner [progressPercentage]="progressPercentage"></app-motivation-banner>

        <!-- Task List -->
        <app-task-list
          [tasks]="tasks"
          (taskToggle)="handleTaskToggle($event)"
        ></app-task-list>

      </div>

      <!-- Right Column - Progress Summary -->
      <div class="space-y-6">
        <!-- Countdown Timer Card -->
        <div class="bg-white rounded-[14px] shadow-sm p-4">
          <app-countdown-timer [deadline]="deadline"></app-countdown-timer>
        </div>

        <!-- Progress Summary Card -->
        <div class="bg-white rounded-[14px] shadow-sm p-6">
          <app-progress-summary
            [completedTasks]="completedTasks"
            [totalTasks]="totalTasks"
            [inProgressTasks]="inProgressTasks"
            [pointsAvailable]="challengePoints"
          ></app-progress-summary>
        </div>

        <!-- Productivity Indicator Card -->
        <div class="bg-white rounded-[14px] shadow-sm p-6">
          <app-productivity-indicator
            [completedTasks]="completedTasks"
            [totalTasks]="totalTasks"
            [daysLeft]="daysLeft"
          ></app-productivity-indicator>
        </div>

        <!-- Activity Timeline Card -->
        <div class="bg-white rounded-[14px] shadow-sm p-6">
          <app-activity-timeline [events]="timelineEvents"></app-activity-timeline>
        </div>

        <!-- Clone Repository Section -->
        <div *ngIf="participantRepoUrl" class="bg-white rounded-[14px] shadow-sm p-6">
          <div class="flex items-center gap-2 mb-4">
            <svg class="w-5 h-5 text-[#1E3A8A]" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            <h3 class="text-base font-semibold text-[#1F2937]">Clone Your Repository</h3>
          </div>
          <p class="text-sm text-[#6B7280] mb-4">Use this command to clone your challenge repository locally and start working on your solution.</p>
          <div class="bg-[#1E293B] rounded-lg p-4 flex items-center justify-between gap-4">
            <code class="font-mono text-sm text-gray-300 break-all">git clone {{ participantRepoUrl }}.git</code>
            <button
              (click)="copyCloneCommand()"
              class="flex-shrink-0 p-2 rounded-md hover:bg-white/10 transition-colors group"
              [title]="cloneCopied ? 'Copied!' : 'Copy to clipboard'">
              <svg *ngIf="!cloneCopied" class="w-4 h-4 text-gray-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke-width="2"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
              </svg>
              <svg *ngIf="cloneCopied" class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Submit Challenge Modal -->
<div *ngIf="showSubmitModal" class="modal-overlay fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="onSubmitModalOverlayClick($event)">
  <div class="bg-white rounded-2xl max-w-4xl w-full overflow-hidden shadow-2xl max-h-[90vh] overflow-y-auto">
    <!-- Header -->
    <div class="bg-gradient-to-br from-[#1E3A8A] to-[#2563EB] px-8 py-6 text-center relative overflow-hidden">
      <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
      <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>
      <h3 class="text-xl font-bold text-white mb-1">Submit Your Challenge</h3>
      <p class="text-white/80 text-sm">A pull request will be created for code review</p>
    </div>

    <!-- Two-column Content -->
    <div class="p-8">
      <!-- Success Message (full width) -->
      <div *ngIf="submitSuccess" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-xl flex items-center gap-3">
        <svg class="w-5 h-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke-width="2"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 12 2 2 4-4"/>
        </svg>
        <p class="text-sm text-green-700">{{ submitSuccess }}</p>
      </div>

      <!-- Error Message (full width) -->
      <div *ngIf="submitError" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center gap-3">
        <svg class="w-5 h-5 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke-width="2"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01"/>
        </svg>
        <p class="text-sm text-red-700">{{ submitError }}</p>
      </div>

      <div *ngIf="!submitSuccess" class="flex gap-8">
        <!-- Left: Steps -->
        <div class="flex-1">
          <div class="bg-[#F0F5FF] rounded-xl p-6 border border-[#1E3A8A]/10 h-full">
            <h4 class="text-sm font-semibold text-[#1F2937] mb-4">Before you submit, make sure you have:</h4>
            <ol class="space-y-3 text-sm text-[#4B5563] mb-5">
              <li class="flex items-start gap-2.5">
                <span class="flex-shrink-0 w-5 h-5 bg-[#1E3A8A] text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5">1</span>
                Created a branch for your solution
              </li>
              <li class="flex items-start gap-2.5">
                <span class="flex-shrink-0 w-5 h-5 bg-[#1E3A8A] text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5">2</span>
                Committed all your changes
              </li>
              <li class="flex items-start gap-2.5">
                <span class="flex-shrink-0 w-5 h-5 bg-[#1E3A8A] text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5">3</span>
                Pushed your branch to the remote repository
              </li>
            </ol>
            <div class="bg-[#1E293B] rounded-lg p-4 font-mono text-xs text-gray-300">
              <div class="space-y-1.5">
                <p><span class="text-[#22D3EE]">git</span> checkout -b my-solution</p>
                <p><span class="text-[#22D3EE]">git</span> add .</p>
                <p><span class="text-[#22D3EE]">git</span> commit -m <span class="text-[#A5D6FF]">"My solution"</span></p>
                <p><span class="text-[#22D3EE]">git</span> push origin my-solution</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Branch Input + Actions -->
        <div class="flex-1 flex flex-col">
          <div class="bg-[#F8FAFC] rounded-xl p-6 border border-gray-100 flex-1">
            <div class="flex items-center gap-2 mb-4">
              <svg class="w-5 h-5 text-[#1E3A8A]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              <h4 class="text-sm font-semibold text-[#1F2937]">Ready to submit?</h4>
            </div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Branch Name</label>
            <input
              type="text"
              [(ngModel)]="submitBranchName"
              placeholder="e.g. main, develop, feature/my-solution"
              [class]="'w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 text-sm ' + (branchError ? 'border-red-300 focus:ring-red-200 focus:border-red-400' : 'border-gray-200 focus:ring-[#1E3A8A]/20 focus:border-[#1E3A8A]')"
            />
            <div *ngIf="branchError" class="mt-2 flex items-start gap-2">
              <svg class="w-4 h-4 text-red-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01"/>
              </svg>
              <p class="text-xs text-red-600">{{ branchError }}</p>
            </div>
            <p *ngIf="!branchError" class="mt-2 text-xs text-gray-500">
              Enter the branch containing your solution. SonarCloud analysis will run automatically after submission.
            </p>
          </div>

          <!-- Actions -->
          <div class="flex gap-3 mt-6">
            <button
              (click)="onCancelSubmit()"
              [disabled]="isSubmitting"
              class="flex-1 py-3 border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium text-sm">
              Cancel
            </button>
            <button
              (click)="onConfirmSubmit()"
              [disabled]="isSubmitting || isCheckingBranch"
              class="flex-1 py-3 bg-[#1E3A8A] text-white rounded-xl hover:bg-[#1E3A8A]/90 transition-colors font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-70">
              <div *ngIf="isSubmitting || isCheckingBranch" class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              {{ isCheckingBranch ? 'Verifying branch...' : (isSubmitting ? 'Submitting...' : 'Submit') }}
            </button>
          </div>
        </div>
      </div>

      <!-- Success footer -->
      <div *ngIf="submitSuccess" class="mt-4">
        <button
          (click)="onCancelSubmit()"
          class="w-full py-3 bg-[#1E3A8A] text-white rounded-xl hover:bg-[#1E3A8A]/90 transition-colors font-medium text-sm">
          Done
        </button>
      </div>
    </div>
  </div>
</div>
